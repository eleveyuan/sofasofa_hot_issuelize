{"id": "1003420", "question": "keras load_model报错", "description": "<div class=\"col-md-11 col-xs-10\"><p>我用Keras构建了一个神经网络，可以训练，也可以用model.save(\"model.h5\")保存模型，但是当我用model = load_model('model.h5')载入模型时就有如下报错：</p><pre><code class=\"python\">Traceback (most recent call last):\n  File \"C:/programming/pycharm/cnn_attention_lstm/cnn_attention_lstm/train7.py\", line 31, in\n    main()\n  File \"C:/programming/pycharm/cnn_attention_lstm/cnn_attention_lstm/train7.py\", line 23, in main\n    history = classifier.fit(data_dir_path=input_dir_path, model_dir_path=output_dir_path, data_set_name=data_set_name)\n  File \"C:\\programming\\pycharm\\cnn_attention_lstm\\cnn_attention_lstm\\model7again.py\", line 113, in fit\n    model = self.create_model()\n  File \"C:\\programming\\pycharm\\cnn_attention_lstm\\cnn_attention_lstm\\model7again.py\", line 66, in create_model\n    model = load_model('model.h5')\n  File \"C:\\Users\\tong\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\keras\\engine\\saving.py\", line 263, in load_model\n    load_weights_from_hdf5_group(f['model_weights'], model.layers)\n  File \"C:\\Users\\tong\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\keras\\engine\\saving.py\", line 915, in load_weights_from_hdf5_group\n    reshape=reshape)\n  File \"C:\\Users\\tong\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\keras\\engine\\saving.py\", line 554, in preprocess_weights_for_loading\n    weights = convert_nested_time_distributed(weights)\n  File \"C:\\Users\\tong\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\keras\\engine\\saving.py\", line 513, in convert_nested_time_distributed\n    layer.layer, weights, original_keras_version, original_backend)\n  File \"C:\\Users\\tong\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\keras\\engine\\saving.py\", line 556, in preprocess_weights_for_loading\n    weights = convert_nested_model(weights)\n  File \"C:\\Users\\tong\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\keras\\engine\\saving.py\", line 532, in convert_nested_model\n    original_backend=original_backend))\n  File \"C:\\Users\\tong\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\keras\\engine\\saving.py\", line 556, in preprocess_weights_for_loading\n    weights = convert_nested_model(weights)\n  File \"C:\\Users\\tong\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\keras\\engine\\saving.py\", line 544, in convert_nested_model\n    original_backend=original_backend))\n  File \"C:\\Users\\tong\\AppData\\Local\\Programs\\Python\\Python36\\Lib\\site-packages\\keras\\engine\\saving.py\", line 673, in preprocess_weights_for_loading\n    elif layer_weights_shape != weights[0].shape:\nIndexError: list index out of range\nProcess finished with exit code 1</code></pre><p><span style=\"font-size: 1rem;\">卡在这里好几天了，萌新求大神点拨，不胜感激</span><br/></p></div>", "viewer": 7104, "tags": ["统计/机器学习", "深度学习", "Python", "人工神经网络", "TensorFlow"], "answers": [{"lvl1_answer": "<div class=\"col-md-11 col-xs-10 p-r\"><p>不知道你的keras的版本是什么，一些版本的确load_model的时候有bug，</p><p>比如这个<a href=\"https://github.com/keras-team/keras/issues/4143\">https://github.com/keras-team/keras/issues/4143</a><a href=\"https://github.com/keras-team/keras/issues/4143\"></a> <a href=\"https://github.com/keras-team/keras/issues/4143\" target=\"_blank\"></a></p><p>还有这个<a href=\"https://github.com/keras-team/keras/issues/10608\">https://github.com/keras-team/keras/issues/10608</a><a href=\"https://github.com/keras-team/keras/issues/10608\" target=\"_blank\"></a></p><p>不同的版本都有类似的问题</p><p>有人自己写了一个save和load，题主可以试试<a href=\"https://github.com/keras-team/keras/issues/10608#issuecomment-427817070\" target=\"_blank\">https://github.com/keras-team/keras/issues/10608#issuecomment-427817070</a></p></div>", "lvl2_answer": []}]}