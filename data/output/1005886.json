{"id": "1005886", "question": "python里计算加权的相关系数？", "description": "<div class=\"col-md-11 col-xs-10\"><p>我知道numpy里有计算正常的相关系数的函数，请问如果是加权的相关系数怎么计算？</p><p>比如我在pandas的dataframe里有三列，一列x，一列y，还有一列是w，表示每行的权重，我怎么计算基于权重w的x和y的相关系数？</p></div>", "viewer": 5184, "tags": ["统计/机器学习", "描述性统计", "Python"], "answers": [{"lvl1_answer": "<div class=\"col-md-11 col-xs-10 p-r\"><p>可以使用<a href=\"https://www.statsmodels.org/stable/generated/statsmodels.stats.weightstats.DescrStatsW.html\" target=\"_blank\">statsmodels.stats.weightstats.DescrStatsW</a>模块</p><pre><code class=\"python\">from statsmodels.stats import weightstats\r\nstats_summary = weightstats.DescrStatsW(df[['x', 'y']], weights=df['w'])\r\nprint(stats_summary.corrcoef[0, 1]</code></pre><p>stats_summary.corrcoef是一个2乘2的对称矩阵，对角线是1，其他位置的元素就是加权的相关系数</p></div>", "lvl2_answer": []}, {"lvl1_answer": "<div class=\"col-md-11 col-xs-10 p-r\"><p>numpy的实现版本如下</p><pre><code class=\"python\">import numpy as np\r\n\r\ndef cov(x, y, w):\r\n    \"\"\"Weighted Covariance\"\"\"\r\n    return np.average((x - m(x, w)) * (y - m(y, w)), weights=w)\r\n\r\ndef corr(x, y, w):\r\n    \"\"\"Weighted Correlation\"\"\"\r\n    return cov(x, y, w) / np.sqrt(cov(x, x, w) * cov(y, y, w))</code></pre></div>", "lvl2_answer": []}]}